<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>process API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>process</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import numpy as np
import torch
import sys
import os.path
sys.path.append(os.path.join(&#34;.&#34;, &#34;script&#34;)) 
from create_pairs import main as create_pairs 
from train_model import main as train_model
from model_evaluation import main as model_evaluation

# CONFIGURATION
# fix random seed for reproducibility for comparison
SEED: int = 1234
torch.manual_seed(SEED)
np.random.seed(SEED)
torch.backends.cudnn.deterministic = True

# PARAMETERS - CHOOSE SCRIPTS TO RUN
CREATE_PAIRS: bool = True # whether to create pairs of news (if False, need to have pairs_{}.csv in the output folder)
TRAIN_MODEL: bool = True # whether to train the model (if False, need to have the necessary model files in the model folder)
MODEL_EVALUATION: bool = True # whether to test the model by classifying news and comparing the results with baseline 

# PARAMETERS - CREATE PAIRS
# paths
PATH_NEWS_CODE: str = os.path.join(&#39;data&#39;, &#39;news_code.csv&#39;) # path to news_code.csv
PATH_NEWS_TRAIN: str = os.path.join(&#39;data&#39;, &#39;news_train&#39;) # path to news files for training
PATH_OUTPUT_PAIRS: str = os.path.join(&#39;data&#39;, &#39;pairs&#39;) # path to output directory for pairs of news
# parameters of the script
NUMBER_OF_PAIRS : int = 200 # number of pairs to create
USE_COSINE : bool = True # whether to compute cosine similarity between headlines
USE_JACCARD : bool = True # whether to compute jaccard similarity between headlines
MIN_APPEARANCES : int = 100 # minimum number of appearances of a word in the corpus (see NewsProcessor.py for more info)
MAX_APPEARANCES : int = np.inf # maximum number of appearances of a word in the corpus (see NewsProcessor.py for more info)
HEADLINE_SIMILARITY_THRESHOLD : float = 0.75 # threshold for maximum headline similarity to create a pair of news

# PARAMETERS - TRAIN MODEL
# paths
PATH_DATA_PAIRS: str = PATH_OUTPUT_PAIRS # path to the pairs data for training (pairs_{}.csv)
PATH_MODEL_SAVE: str = os.path.join(&#39;model&#39;) # output path to save the model
# parameters of the script
DATA_SIZE_PAIRS: int = NUMBER_OF_PAIRS # size of the dataset to use for training
MODEL_NAME: str = &#39;sentence-transformers/multi-qa-mpnet-base-dot-v1&#39; # pre-trained Sentence-Transformer model to use 
LABEL: str = &#34;similarity_cosine&#34; # choose label to use, either &#39;similarity_cosine&#39;, &#39;similarity_jaccard&#39;
# hyperparameters to tune
EPOCHS: int = 8 # number of epochs to train the model 
SCHEDULER: str = &#39;warmupLinear&#39; # scheduler to change learning rate, either &#39;warmupConstant&#39;, &#39;warmupLinear&#39;, &#39;warmupCosine&#39;

# PARAMETERS - EVALUATE MODEL (CLASSIFICATION)
# paths
PATH_NEWS_CODE: str = os.path.join(&#39;data&#39;, &#39;news_code.csv&#39;) # path to news code file
PATH_NEWS_TEST: str = os.path.join(&#39;data&#39;, &#39;news_test&#39;) # path to news data for testing
PATH_OUTPUT_SCORES: str = os.path.join(&#39;scores&#39;, &#39;scores_classification.csv&#39;) # path to output file of scores for classification
PATH_MODEL: str = PATH_MODEL_SAVE # path to load the local SentenceTransformer model
# parameters of the script
DATA_SIZE_EVALUATION: int = 100 # number of news to use for evaluation
N_SUBJECTS: int = -1 # number of subjects per news to keep (-1 means all subjects)
BASELINE_ST_MODEL: str = &#39;sentence-transformers/multi-qa-mpnet-base-dot-v1&#39; # pre-trained Sentence-Transformer model to use for baseline


def main() -&gt; None:
    &#34;&#34;&#34;
    Main function to run the whole process of creating pairs of news, training the model and testing it. 
    Set the parameters above to True or False to choose which processes to run.
    &#34;&#34;&#34;

    if CREATE_PAIRS :
        print(&#34;\nCREATE PAIRS&#34;)
        print(&#34;=================\n&#34;)
        create_pairs(
            path_news_code=PATH_NEWS_CODE, 
            path_news_train=PATH_NEWS_TRAIN, 
            path_output_pairs=PATH_OUTPUT_PAIRS, 
            number_of_pairs=NUMBER_OF_PAIRS,
            use_cosine=USE_COSINE, 
            use_jaccard=USE_JACCARD,
            min_appearances=MIN_APPEARANCES,
            max_appearances=MAX_APPEARANCES,
            similarity_threshold=HEADLINE_SIMILARITY_THRESHOLD
        )
        print(&#34;\n-----------------\n\n&#34;)

    if TRAIN_MODEL :
        print(&#34;\nTRAIN MODEL&#34;)
        print(&#34;=================\n&#34;)
        train_model(
            path_data_pairs=PATH_DATA_PAIRS,
            path_model_save=PATH_MODEL_SAVE,
            data_size=DATA_SIZE_PAIRS,
            model_name=MODEL_NAME,
            label=LABEL,
            epochs=EPOCHS,
            scheduler=SCHEDULER,
        )
        print(&#34;\n-----------------\n\n&#34;)
        
    if MODEL_EVALUATION :
        print(&#34;\nMODEL EVALUATION&#34;)
        print(&#34;=================\n&#34;)
        model_evaluation(
            path_news_code=PATH_NEWS_CODE,
            path_news_test=PATH_NEWS_TEST,
            path_output_scores=PATH_OUTPUT_SCORES,
            path_model=PATH_MODEL,
            data_size=DATA_SIZE_EVALUATION,
            n_subjects=N_SUBJECTS,
            baseline_st_model=BASELINE_ST_MODEL
        )
        print(&#34;\n-----------------\n\n&#34;)

    print(&#34;\nAll the processes have been run.\n&#34;)


if __name__ == &#39;__main__&#39;:
    main()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="process.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Main function to run the whole process of creating pairs of news, training the model and testing it.
Set the parameters above to True or False to choose which processes to run.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main() -&gt; None:
    &#34;&#34;&#34;
    Main function to run the whole process of creating pairs of news, training the model and testing it. 
    Set the parameters above to True or False to choose which processes to run.
    &#34;&#34;&#34;

    if CREATE_PAIRS :
        print(&#34;\nCREATE PAIRS&#34;)
        print(&#34;=================\n&#34;)
        create_pairs(
            path_news_code=PATH_NEWS_CODE, 
            path_news_train=PATH_NEWS_TRAIN, 
            path_output_pairs=PATH_OUTPUT_PAIRS, 
            number_of_pairs=NUMBER_OF_PAIRS,
            use_cosine=USE_COSINE, 
            use_jaccard=USE_JACCARD,
            min_appearances=MIN_APPEARANCES,
            max_appearances=MAX_APPEARANCES,
            similarity_threshold=HEADLINE_SIMILARITY_THRESHOLD
        )
        print(&#34;\n-----------------\n\n&#34;)

    if TRAIN_MODEL :
        print(&#34;\nTRAIN MODEL&#34;)
        print(&#34;=================\n&#34;)
        train_model(
            path_data_pairs=PATH_DATA_PAIRS,
            path_model_save=PATH_MODEL_SAVE,
            data_size=DATA_SIZE_PAIRS,
            model_name=MODEL_NAME,
            label=LABEL,
            epochs=EPOCHS,
            scheduler=SCHEDULER,
        )
        print(&#34;\n-----------------\n\n&#34;)
        
    if MODEL_EVALUATION :
        print(&#34;\nMODEL EVALUATION&#34;)
        print(&#34;=================\n&#34;)
        model_evaluation(
            path_news_code=PATH_NEWS_CODE,
            path_news_test=PATH_NEWS_TEST,
            path_output_scores=PATH_OUTPUT_SCORES,
            path_model=PATH_MODEL,
            data_size=DATA_SIZE_EVALUATION,
            n_subjects=N_SUBJECTS,
            baseline_st_model=BASELINE_ST_MODEL
        )
        print(&#34;\n-----------------\n\n&#34;)

    print(&#34;\nAll the processes have been run.\n&#34;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="process.main" href="#process.main">main</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>